<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Spatial Data Science with R</title>
  <meta name="description" content="description_xx">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Spatial Data Science with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="description_xx" />
  <meta name="github-repo" content="edzer/sdsr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Spatial Data Science with R" />
  
  <meta name="twitter:description" content="description_xx" />
  

<meta name="author" content="Edzer Pebesma, Roger Bivand">


<meta name="date" content="2018-05-15">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="spaces.html">
<link rel="next" href="vectorraster.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial Data Science with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Spatial Data</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-first-map"><i class="fa fa-check"></i><b>1.1</b> A first map</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#reading"><i class="fa fa-check"></i><b>1.2</b> Reading and writing</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="spaces.html"><a href="spaces.html"><i class="fa fa-check"></i><b>2</b> Spaces</a><ul>
<li class="chapter" data-level="2.1" data-path="spaces.html"><a href="spaces.html#cartesian-and-polar-coordinates"><i class="fa fa-check"></i><b>2.1</b> Cartesian and polar coordinates</a></li>
<li class="chapter" data-level="2.2" data-path="spaces.html"><a href="spaces.html#spherical-and-ellipsoidal-coordinates"><i class="fa fa-check"></i><b>2.2</b> Spherical and ellipsoidal coordinates</a></li>
<li class="chapter" data-level="2.3" data-path="spaces.html"><a href="spaces.html#distances"><i class="fa fa-check"></i><b>2.3</b> Distances</a></li>
<li class="chapter" data-level="2.4" data-path="spaces.html"><a href="spaces.html#bounded-spaces"><i class="fa fa-check"></i><b>2.4</b> Bounded spaces</a></li>
<li class="chapter" data-level="2.5" data-path="spaces.html"><a href="spaces.html#time"><i class="fa fa-check"></i><b>2.5</b> Time</a></li>
<li class="chapter" data-level="2.6" data-path="spaces.html"><a href="spaces.html#exercises-1"><i class="fa fa-check"></i><b>2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="geometries.html"><a href="geometries.html"><i class="fa fa-check"></i><b>3</b> Geometries</a><ul>
<li class="chapter" data-level="3.1" data-path="geometries.html"><a href="geometries.html#simple-feature-geometries"><i class="fa fa-check"></i><b>3.1</b> Simple feature geometries</a></li>
<li class="chapter" data-level="3.2" data-path="geometries.html"><a href="geometries.html#sfc-simple-feature-geometry-list-columns"><i class="fa fa-check"></i><b>3.2</b> <code>sfc</code>: Simple feature geometry list-columns</a></li>
<li class="chapter" data-level="3.3" data-path="geometries.html"><a href="geometries.html#geometries-on-the-spheroid"><i class="fa fa-check"></i><b>3.3</b> Geometries on the spheroid</a></li>
<li class="chapter" data-level="3.4" data-path="geometries.html"><a href="geometries.html#other-geometries"><i class="fa fa-check"></i><b>3.4</b> Other geometries</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="vectorraster.html"><a href="vectorraster.html"><i class="fa fa-check"></i><b>4</b> Vector/Raster</a></li>
<li class="chapter" data-level="5" data-path="geommanip.html"><a href="geommanip.html"><i class="fa fa-check"></i><b>5</b> Geometric Manipulations</a><ul>
<li class="chapter" data-level="5.1" data-path="geommanip.html"><a href="geommanip.html#unary-operations"><i class="fa fa-check"></i><b>5.1</b> Unary Operations</a></li>
<li class="chapter" data-level="5.2" data-path="geommanip.html"><a href="geommanip.html#binary-operations"><i class="fa fa-check"></i><b>5.2</b> Binary Operations</a></li>
<li class="chapter" data-level="5.3" data-path="geommanip.html"><a href="geommanip.html#n-ary-operations"><i class="fa fa-check"></i><b>5.3</b> N-ary Operations</a></li>
<li class="chapter" data-level="5.4" data-path="geommanip.html"><a href="geommanip.html#precision"><i class="fa fa-check"></i><b>5.4</b> Precision</a></li>
<li class="chapter" data-level="5.5" data-path="geommanip.html"><a href="geommanip.html#warnings-for-longitudelatitude-geometries"><i class="fa fa-check"></i><b>5.5</b> Warnings for longitude/latitude geometries</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="featureattributes.html"><a href="featureattributes.html"><i class="fa fa-check"></i><b>6</b> Feature attributes</a><ul>
<li class="chapter" data-level="6.1" data-path="featureattributes.html"><a href="featureattributes.html#agr"><i class="fa fa-check"></i><b>6.1</b> Attribute-geometry relationship</a></li>
<li class="chapter" data-level="6.2" data-path="featureattributes.html"><a href="featureattributes.html#spatial-join"><i class="fa fa-check"></i><b>6.2</b> Spatial join</a></li>
<li class="chapter" data-level="6.3" data-path="featureattributes.html"><a href="featureattributes.html#aggregate-and-summarise"><i class="fa fa-check"></i><b>6.3</b> Aggregate and summarise</a></li>
<li class="chapter" data-level="6.4" data-path="featureattributes.html"><a href="featureattributes.html#intersections"><i class="fa fa-check"></i><b>6.4</b> Intersections</a></li>
<li class="chapter" data-level="6.5" data-path="featureattributes.html"><a href="featureattributes.html#area-weighted-interpolation"><i class="fa fa-check"></i><b>6.5</b> Area-weighted interpolation</a></li>
<li class="chapter" data-level="6.6" data-path="featureattributes.html"><a href="featureattributes.html#exercises-2"><i class="fa fa-check"></i><b>6.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rs.html"><a href="rs.html"><i class="fa fa-check"></i><b>7</b> Reference Systems</a><ul>
<li class="chapter" data-level="7.1" data-path="rs.html"><a href="rs.html#units"><i class="fa fa-check"></i><b>7.1</b> Units of measurement</a></li>
<li class="chapter" data-level="7.2" data-path="rs.html"><a href="rs.html#crs"><i class="fa fa-check"></i><b>7.2</b> Coordinate Reference Systems</a></li>
<li class="chapter" data-level="7.3" data-path="rs.html"><a href="rs.html#transform"><i class="fa fa-check"></i><b>7.3</b> Coordinate transformation and conversion</a></li>
</ul></li>
<li class="part"><span><b>II Maps</b></span></li>
<li class="chapter" data-level="8" data-path="plotting-spatial-data.html"><a href="plotting-spatial-data.html"><i class="fa fa-check"></i><b>8</b> Plotting spatial data</a></li>
<li class="chapter" data-level="9" data-path="plot.html"><a href="plot.html"><i class="fa fa-check"></i><b>9</b> Base Plot</a></li>
<li class="chapter" data-level="10" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>10</b> ggplot2</a></li>
<li class="chapter" data-level="11" data-path="interactive-maps.html"><a href="interactive-maps.html"><i class="fa fa-check"></i><b>11</b> Interactive Maps</a></li>
<li class="part"><span><b>III Spatial Analysis</b></span></li>
<li class="chapter" data-level="12" data-path="summarizing-geometries.html"><a href="summarizing-geometries.html"><i class="fa fa-check"></i><b>12</b> Summarizing Geometries</a></li>
<li class="chapter" data-level="13" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html"><i class="fa fa-check"></i><b>13</b> Point Pattern Analysis</a></li>
<li class="chapter" data-level="14" data-path="manipulating-attributes-summarise-aggregate-union-sample.html"><a href="manipulating-attributes-summarise-aggregate-union-sample.html"><i class="fa fa-check"></i><b>14</b> Manipulating attributes: summarise, aggregate, union, sample</a></li>
<li class="chapter" data-level="15" data-path="units-of-measure-revisited-attribute-units-intensive-and-extensive-variables.html"><a href="units-of-measure-revisited-attribute-units-intensive-and-extensive-variables.html"><i class="fa fa-check"></i><b>15</b> Units of measure revisited: attribute units, intensive and extensive variables</a></li>
<li class="chapter" data-level="16" data-path="up-and-downscaling.html"><a href="up-and-downscaling.html"><i class="fa fa-check"></i><b>16</b> Up- and Downscaling</a></li>
<li class="chapter" data-level="17" data-path="spatial-interpolation-and-geostatistics.html"><a href="spatial-interpolation-and-geostatistics.html"><i class="fa fa-check"></i><b>17</b> Spatial Interpolation and geostatistics</a></li>
<li class="chapter" data-level="18" data-path="area-data-and-spatial-correlation.html"><a href="area-data-and-spatial-correlation.html"><i class="fa fa-check"></i><b>18</b> Area Data and Spatial Correlation</a></li>
<li class="chapter" data-level="19" data-path="spatial-regression-and-autocorrelation.html"><a href="spatial-regression-and-autocorrelation.html"><i class="fa fa-check"></i><b>19</b> Spatial Regression and Autocorrelation</a></li>
<li class="chapter" data-level="20" data-path="raster-modelling.html"><a href="raster-modelling.html"><i class="fa fa-check"></i><b>20</b> Raster Modelling</a></li>
<li class="part"><span><b>IV Spatiotemporal Analysis</b></span></li>
<li class="chapter" data-level="21" data-path="array.html"><a href="array.html"><i class="fa fa-check"></i><b>21</b> Array data: raster and vector data cubes</a></li>
<li class="chapter" data-level="22" data-path="movement-data.html"><a href="movement-data.html"><i class="fa fa-check"></i><b>22</b> Movement data</a></li>
<li class="chapter" data-level="23" data-path="statistical-modelling-of-spatiotemporal-data.html"><a href="statistical-modelling-of-spatiotemporal-data.html"><i class="fa fa-check"></i><b>23</b> Statistical modelling of spatiotemporal data</a></li>
<li class="chapter" data-level="24" data-path="scalability.html"><a href="scalability.html"><i class="fa fa-check"></i><b>24</b> Scalability</a></li>
<li class="chapter" data-level="" data-path="r-data-structures.html"><a href="r-data-structures.html"><i class="fa fa-check"></i>R data structures</a><ul>
<li class="chapter" data-level="24.1" data-path="r-data-structures.html"><a href="r-data-structures.html#homogeneous-vectors"><i class="fa fa-check"></i><b>24.1</b> Homogeneous vectors</a></li>
<li class="chapter" data-level="24.2" data-path="r-data-structures.html"><a href="r-data-structures.html#heterogeneous-vectors-list"><i class="fa fa-check"></i><b>24.2</b> Heterogeneous vectors: list</a></li>
<li class="chapter" data-level="24.3" data-path="r-data-structures.html"><a href="r-data-structures.html#attributes"><i class="fa fa-check"></i><b>24.3</b> Attributes</a></li>
<li class="chapter" data-level="24.4" data-path="r-data-structures.html"><a href="r-data-structures.html#various-names-attributes"><i class="fa fa-check"></i><b>24.4</b> various names attributes</a></li>
<li class="chapter" data-level="24.5" data-path="r-data-structures.html"><a href="r-data-structures.html#using-structure"><i class="fa fa-check"></i><b>24.5</b> using structure</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial Data Science with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="geometries" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Geometries</h1>
<p>Having learned how we describe spaces, we can define how geometries can be described in these space.</p>
<div id="simple-feature-geometries" class="section level2">
<h2><span class="header-section-number">3.1</span> Simple feature geometries</h2>
<p>Simple feature geometries are a way to describe the geometries of <em>features</em>. By <em>features</em> we mean <em>things</em> that have a geometry, some time properties, and other attributes. The main application of simple feature geometries is to describe two-dimensional geometries by points, lines, or polygons. The “simple” adjective refers to the fact that the line or polygon geometries are represented by sequences of points connected with straight lines.</p>
<p><em>Simple features access</em> is a standard <span class="citation">(Herring <a href="#ref-sfa">2011</a>, <span class="citation">Herring (<a href="#ref-sfa2">2010</a>)</span>, <span class="citation">ISO (<a href="#ref-iso">2004</a>)</span>)</span>. for describing simple feature geometries that includes</p>
<ul>
<li>a class hierarchy</li>
<li>a set of operations</li>
<li>binary and text encodings</li>
</ul>
<p>We will now discuss the seven most common simple feature geometry types. Although in practice we will most often import spatial data from external sources (files, databases, web services), we will create them here from scratch using simple constructor functions.</p>
<div id="the-big-seven" class="section level3">
<h3><span class="header-section-number">3.1.1</span> The big seven</h3>
<p>The most commonly used simple features geometries, used to represent a <em>single</em> feature are:</p>
<table>
<thead>
<tr class="header">
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>POINT</code></td>
<td>single point geometry</td>
</tr>
<tr class="even">
<td><code>MULTIPOINT</code></td>
<td>set of points</td>
</tr>
<tr class="odd">
<td><code>LINESTRING</code></td>
<td>single line</td>
</tr>
<tr class="even">
<td><code>MULTILINESTRING</code></td>
<td>multiple lines</td>
</tr>
<tr class="odd">
<td><code>POLYGON</code></td>
<td>exterior ring with zero or more inner rings, denoting holes</td>
</tr>
<tr class="even">
<td><code>MULTIPOLYGON</code></td>
<td>set of polygons</td>
</tr>
<tr class="odd">
<td><code>GEOMETRYCOLLECTION</code></td>
<td>set of geometries</td>
</tr>
</tbody>
</table>
<p>A <code>POINT</code> can be created by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">pt =</span> <span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">7</span>)))
<span class="co">#&gt; POINT (5 7)</span></code></pre></div>
<p>Points and vertices in simple feature geometries represent XY coordinates, in that order. A <code>MULTIPOINT</code> or a <code>LINESTRING</code> can be created by a matrix</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">m1 =</span> <span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">5</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>)))
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    8    1</span>
<span class="co">#&gt; [2,]    2    5</span>
<span class="co">#&gt; [3,]    3    2</span>
(<span class="dt">mp =</span> <span class="kw">st_multipoint</span>(m1))
<span class="co">#&gt; MULTIPOINT (8 1, 2 5, 3 2)</span>
(<span class="dt">ls =</span> <span class="kw">st_linestring</span>(m1))
<span class="co">#&gt; LINESTRING (8 1, 2 5, 3 2)</span></code></pre></div>
<p>Although these geometries contain the same points, they have entirely different meaning:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">st_dimension</span>(mp)
<span class="co">#&gt; [1] 0</span>
<span class="kw">st_dimension</span>(ls)
<span class="co">#&gt; [1] 1</span></code></pre></div>
<p>A <code>MULTILINESTRING</code> can be constructed from a list of matrices, representing vertices:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m2 =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">22</span>,<span class="dv">20</span>), <span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">15</span>))
mls =<span class="st"> </span><span class="kw">st_multilinestring</span>(<span class="kw">list</span>(m1, m2))</code></pre></div>
<p>A <code>POLYGON</code> consists of an outer ring, followed by zero or more inner rings that denote holes in the outer ring:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">ring1 =</span> <span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)))
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    0    0</span>
<span class="co">#&gt; [2,]    4    0</span>
<span class="co">#&gt; [3,]    4    4</span>
<span class="co">#&gt; [4,]    0    4</span>
<span class="co">#&gt; [5,]    0    0</span>
(<span class="dt">p1 =</span> <span class="kw">st_polygon</span>(<span class="kw">list</span>(ring1)))
<span class="co">#&gt; POLYGON ((0 0, 4 0, 4 4, 0 4, 0 0))</span>
(<span class="dt">ring2 =</span> ring1 <span class="op">+</span><span class="st"> </span><span class="dv">5</span>)
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    5    5</span>
<span class="co">#&gt; [2,]    9    5</span>
<span class="co">#&gt; [3,]    9    9</span>
<span class="co">#&gt; [4,]    5    9</span>
<span class="co">#&gt; [5,]    5    5</span>
(<span class="dt">ring3 =</span> (ring1[<span class="dv">5</span><span class="op">:</span><span class="dv">1</span>,] <span class="op">/</span><span class="st"> </span><span class="dv">4</span>) <span class="op">+</span><span class="st"> </span><span class="dv">6</span>)
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    6    6</span>
<span class="co">#&gt; [2,]    6    7</span>
<span class="co">#&gt; [3,]    7    7</span>
<span class="co">#&gt; [4,]    7    6</span>
<span class="co">#&gt; [5,]    6    6</span>
(<span class="dt">p2 =</span> <span class="kw">st_polygon</span>(<span class="kw">list</span>(ring2, ring3)))
<span class="co">#&gt; POLYGON ((5 5, 9 5, 9 9, 5 9, 5 5), (6 6, 6 7, 7 7, 7 6, 6 6))</span></code></pre></div>
<p>A <code>MULTIPOLYGON</code> can be constructed as a list of lists of matrices:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">mpol =</span> <span class="kw">st_multipolygon</span>(<span class="kw">list</span>(<span class="kw">list</span>(ring1), <span class="kw">list</span>(ring2, ring3))))
<span class="co">#&gt; MULTIPOLYGON (((0 0, 4 0, 4 4, 0 4, 0 0)), ((5 5, 9 5, 9 9, 5 9, 5 5), (6 6, 7 6, 7 7, 6 7, 6 6)))</span></code></pre></div>
<p>And finally, a <code>GEOMETRYCOLLECTION</code> can be constructed from a list of typed geometries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">st_geometrycollection</span>(<span class="kw">list</span>(pt, mp, ls, mpol))
<span class="co">#&gt; GEOMETRYCOLLECTION (POINT (5 7), MULTIPOINT (8 1, 2 5, 3 2), LINESTRING (8 1, 2 5, 3 2), MULTIPOLYGON (((0 0, 4 0, 4 4, 0 4, 0 0)), ((5 5, 9 5, 9 9, 5 9, 5 5), (6 6, 7 6, 7 7, 6 7, 6 6))))</span></code></pre></div>
</div>
<div id="constraints" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Constraints</h3>
<p>The following constraints to simple feature geometries are useful to note:</p>
<ul>
<li>lines shall not self-intersect</li>
<li>polygon rings shall be closed (the last point equals the first)</li>
<li>polygon holes (inner rings) shall be inside their exterior ring</li>
<li>polygon inner rings shall maximally touch the exterior ring in single points, not over a line</li>
<li>a polygon ring shall not repeat its own path</li>
</ul>
<p>Functions <code>st_is_simple</code> and <code>st_is_valid</code> help detect non-simple and non-valid geometries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">st_is_simple</span>(<span class="kw">st_linestring</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))) <span class="co"># self-intersects</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="kw">st_is_valid</span>(<span class="kw">st_polygon</span>(<span class="kw">list</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))))) <span class="co"># repeats</span>
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
</div>
<div id="z-and-m" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Z and M</h3>
<p>In addition to X and Y coordinates, Single points (vertices) of simple feature geometries can have</p>
<ul>
<li>a <code>Z</code> coordinate, denoting altitude</li>
<li>an <code>M</code> value, denoting some “measure”</li>
</ul>
<p>but it should be noted that infrastructure for truly three-dimensional geometries is not available. Practically all functions available for simple feature geometries only operate on the XY dimensions.</p>
<p>The <code>M</code> attribute shall be a property of the vertex. It sounds attractive to encode a time stamp in it, e.g. to pack trajectories in <code>LINESTRING</code>s. These become however invalid once the trajectory self-intersects.</p>
<p>Some examples of <code>XYZ</code> and <code>XYM</code> and <code>XYZM</code> geometries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.file</span>(<span class="st">&quot;shape/storms_xyz_feature.shp&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">st_read</span>()
<span class="co">#&gt; Reading layer `storms_xyz_feature&#39; from data source `/home/edzer/R/x86_64-pc-linux-gnu-library/3.4/sf/shape/storms_xyz_feature.shp&#39; using driver `ESRI Shapefile&#39;</span>
<span class="co">#&gt; Simple feature collection with 71 features and 1 field</span>
<span class="co">#&gt; geometry type:  LINESTRING</span>
<span class="co">#&gt; dimension:      XYZ</span>
<span class="co">#&gt; bbox:           xmin: -102 ymin: 8.3 xmax: 0 ymax: 59.5</span>
<span class="co">#&gt; epsg (SRID):    NA</span>
<span class="co">#&gt; proj4string:    NA</span>
<span class="kw">system.file</span>(<span class="st">&quot;shape/storms_xyzm_feature.shp&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># badly named!</span>
<span class="st">    </span><span class="kw">st_read</span>()
<span class="co">#&gt; Reading layer `storms_xyzm_feature&#39; from data source `/home/edzer/R/x86_64-pc-linux-gnu-library/3.4/sf/shape/storms_xyzm_feature.shp&#39; using driver `ESRI Shapefile&#39;</span>
<span class="co">#&gt; Simple feature collection with 71 features and 1 field</span>
<span class="co">#&gt; geometry type:  LINESTRING</span>
<span class="co">#&gt; dimension:      XYM</span>
<span class="co">#&gt; bbox:           xmin: -102 ymin: 8.3 xmax: 0 ymax: 59.5</span>
<span class="co">#&gt; epsg (SRID):    NA</span>
<span class="co">#&gt; proj4string:    NA</span>
(<span class="dt">pzm =</span> <span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)))
<span class="co">#&gt; POINT ZM (1 2 3 4)</span></code></pre></div>
</div>
<div id="the-other-ten" class="section level3">
<h3><span class="header-section-number">3.1.4</span> The other ten</h3>
<p>There are 10 more geometry types which are more rare, but increasingly find implementation:</p>
<table style="width:78%;">
<colgroup>
<col width="6%" />
<col width="70%" />
</colgroup>
<thead>
<tr class="header">
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>CIRCULARSTRING</code></td>
<td>The CIRCULARSTRING is the basic curve type, similar to a LINESTRING in the linear world. A single segment requires three points, the start and end points (first and third) and any other point on the arc. The exception to this is for a closed circle, where the start and end points are the same. In this case the second point MUST be the center of the arc, ie the opposite side of the circle. To chain arcs together, the last point of the previous arc becomes the first point of the next arc, just like in LINESTRING. This means that a valid circular string must have an odd number of points greated than 1.</td>
</tr>
<tr class="even">
<td><code>COMPOUNDCURVE</code></td>
<td>A compound curve is a single, continuous curve that has both curved (circular) segments and linear segments. That means that in addition to having well-formed components, the end point of every component (except the last) must be coincident with the start point of the following component.</td>
</tr>
<tr class="odd">
<td><code>CURVEPOLYGON</code></td>
<td>Example compound curve in a curve polygon: CURVEPOLYGON(COMPOUNDCURVE(CIRCULARSTRING(0 0,2 0, 2 1, 2 3, 4 3),(4 3, 4 5, 1 4, 0 0)), CIRCULARSTRING(1.7 1, 1.4 0.4, 1.6 0.4, 1.6 0.5, 1.7 1) )</td>
</tr>
<tr class="even">
<td><code>MULTICURVE</code></td>
<td>A MultiCurve is a 1-dimensional GeometryCollection whose elements are Curves, it can include linear strings, circular strings or compound strings.</td>
</tr>
<tr class="odd">
<td><code>MULTISURFACE</code></td>
<td>A MultiSurface is a 2-dimensional GeometryCollection whose elements are Surfaces, all using coordinates from the same coordinate reference system.</td>
</tr>
<tr class="even">
<td><code>CURVE</code></td>
<td>A Curve is a 1-dimensional geometric object usually stored as a sequence of Points, with the subtype of Curve specifying the form of the interpolation between Points</td>
</tr>
<tr class="odd">
<td><code>SURFACE</code></td>
<td>A Surface is a 2-dimensional geometric object</td>
</tr>
<tr class="even">
<td><code>POLYHEDRALSURFACE</code></td>
<td>A PolyhedralSurface is a contiguous collection of polygons, which share common boundary segments</td>
</tr>
<tr class="odd">
<td><code>TIN</code></td>
<td>A TIN (triangulated irregular network) is a PolyhedralSurface consisting only of Triangle patches.</td>
</tr>
<tr class="even">
<td><code>TRIANGLE</code></td>
<td>A Triangle is a polygon with 3 distinct, non-collinear vertices and no interior boundary</td>
</tr>
</tbody>
</table>
<p>Note that <code>CIRCULASTRING</code>, <code>COMPOUNDCURVE</code> and <code>CURVEPOLYGON</code> are not described in the SFA standard, but in the <a href="https://www.iso.org/standard/38651.html">SQL-MM part 3 standard</a>. The descriptions above were copied from the <a href="http://postgis.net/docs/using_postgis_dbmanagement.html">PostGIS manual</a>.</p>
<p><code>CURVE</code>, <code>COMPOUNDCURVE</code> and <code>CIRCULARSTRING</code> have <code>st_cast</code> methods to cast them to <code>LINESTRING</code>; <code>MULTISURFACE</code> has an <code>st_cast</code> method to <code>MULTIPOLYGON</code>. An example is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(ls &lt;-<span class="st"> </span><span class="kw">st_as_sfc</span>(<span class="st">&quot;CIRCULARSTRING(0 0,1 0,1 1)&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_cast</span>(<span class="st">&quot;LINESTRING&quot;</span>))
<span class="co">#&gt; Geometry set for 1 feature </span>
<span class="co">#&gt; geometry type:  LINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 0 ymin: -0.207 xmax: 1.21 ymax: 1</span>
<span class="co">#&gt; epsg (SRID):    NA</span>
<span class="co">#&gt; proj4string:    NA</span>
<span class="co">#&gt; LINESTRING (0 0, 0.0361 -0.0337, 0.0745 -0.0647...</span>
<span class="kw">plot</span>(ls, <span class="dt">axes =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="sdsr_files/figure-html/unnamed-chunk-41-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="encodings-wkt-wkb" class="section level3">
<h3><span class="header-section-number">3.1.5</span> Encodings: WKT, WKB</h3>
<p>Part of the simple feature standard are two encodings: a text and a binary encoding. The text strings <code>POINT (0 1)</code> and so on indicate text encodings, also known as <em>well-known text</em> (WKT) encodings, of simple feature geometries. They are meant for human readability. By default, package <code>sf</code> prints the same number of digits as R, but this can be manipulated:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>))
<span class="co">#&gt; POINT (0.333 0.667)</span>
old =<span class="st"> </span><span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">16</span>)
<span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>))
<span class="co">#&gt; POINT (0.3333333333333333 0.6666666666666666)</span>
<span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">3</span>)
<span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>))
<span class="co">#&gt; POINT (0.333 0.667)</span>
<span class="kw">options</span>(<span class="dt">digits =</span> old<span class="op">$</span>digits) <span class="co"># set back</span></code></pre></div>
<p>An encoding that is more useful for machine-to-machine communication is <em>well-known binary</em>. An example of a round-trip R <span class="math inline">\(\rightarrow\)</span> binary <span class="math inline">\(\rightarrow\)</span> R is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">wkb =</span> <span class="kw">st_as_binary</span>(<span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>))))
<span class="co">#&gt;  [1] 01 01 00 00 00 55 55 55 55 55 55 d5 3f 55 55 55 55 55 55 e5 3f</span>
<span class="kw">st_as_sfc</span>(wkb)[[<span class="dv">1</span>]]
<span class="co">#&gt; POINT (0.333 0.667)</span></code></pre></div>
<p>Object <code>r</code> is a raw vector, which is little useful in R. Binary conversion is used to communicate geometries to external libraries (GDAL, GEOS, liblwgeom) and and spatial databases: it is fast, and lossless. Whenever there is a choice, binary encoding should be prefered over text encoding.</p>
</div>
</div>
<div id="sfc-simple-feature-geometry-list-columns" class="section level2">
<h2><span class="header-section-number">3.2</span> <code>sfc</code>: Simple feature geometry list-columns</h2>
<div id="individual-geometries" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Individual geometries</h3>
<p>This section describes the implementation of simple feature geometries in package <code>sf</code>. It will first explain how single simple feature geometry objects are represented in R data structures of class <code>sfg</code>. Next, it will explain how <em>sets</em> of simple feature geometry objects are collected in a list of class <code>sfc</code>. This list acts as a geometry <em>list-column</em> in data.frame objects, of class <code>sf</code>.</p>
<p>Single simple feature geometry objects are implemented pretty much like the arguments to their constructor function, that is, as a</p>
<ul>
<li>numeric vector for <code>POINT</code>,</li>
<li>numeric matrix for <code>MULTIPOINT</code> and <code>LINESTRING</code></li>
<li>list of numeric matrices for <code>MULTILINESTRING</code> and <code>POLYGON</code></li>
<li>list of lists of numeric matrices for <code>MULTIPOLYGON</code></li>
<li>list of typed geometries for <code>GEOMETRYCOLLECTION</code></li>
</ul>
<p>All other geometry types use the simples possible from this list. Objects have a class indicating their dimension, type, and a superclass (<code>sfg</code> for simple feature geometry), and have no other attributes than their S3 class:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attributes</span>(mpol)
<span class="co">#&gt; $class</span>
<span class="co">#&gt; [1] &quot;XY&quot;           &quot;MULTIPOLYGON&quot; &quot;sfg&quot;</span>
<span class="kw">attributes</span>(pzm)
<span class="co">#&gt; $class</span>
<span class="co">#&gt; [1] &quot;XYZM&quot;  &quot;POINT&quot; &quot;sfg&quot;</span></code></pre></div>
</div>
<div id="sets-of-geometries" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Sets of geometries</h3>
<p>Rather than handling geometries individually, we typically handle them as sets. We can do that by <em>naively</em> putting them in a list, but package <code>sf</code> provides a dedicated class for this, called <code>sfc</code> (for simple feature geometry list column). We can create such a list with <code>st_sfc</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">sfc =</span> <span class="kw">st_sfc</span>(<span class="kw">st_point</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), <span class="kw">st_point</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>,<span class="dv">2</span>)), <span class="dt">crs =</span> <span class="dv">4326</span>))
<span class="co">#&gt; Geometry set for 2 features </span>
<span class="co">#&gt; geometry type:  POINT</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -3 ymin: 1 xmax: 0 ymax: 2</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt; POINT (0 1)</span>
<span class="co">#&gt; POINT (-3 2)</span></code></pre></div>
<p>The default report from the <code>print</code> method for <code>sfc</code> gives</p>
<ul>
<li>the number of features geometries</li>
<li>the feature geometry type (<code>POINT</code>)</li>
<li>the feature geometry dimension (<code>XY</code>)</li>
<li>the bounding box for the set</li>
<li>the coordinate reference system for the set (<code>epsg</code> and <code>proj4string</code>: this is discussed in chapter <a href="rs.html#crs">7.2</a>)</li>
<li>the first few geometries, as WKT</li>
</ul>
<p>The class of the geometry list-column,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(sfc)
<span class="co">#&gt; [1] &quot;sfc_POINT&quot; &quot;sfc&quot;</span></code></pre></div>
<p>is again a combination of a specific class, and a super class. In addition to a <code>class</code>, the object has further attributes</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(<span class="kw">attributes</span>(sfc))
<span class="co">#&gt; [1] &quot;class&quot;     &quot;precision&quot; &quot;bbox&quot;      &quot;crs&quot;       &quot;n_empty&quot;</span></code></pre></div>
<p>which are used to record <em>for the hole set</em>:</p>
<ul>
<li>a precision value (see section @ref{precision})</li>
<li>the bounding box enclosing all geometries (for x and y)</li>
<li>a coordinate reference system (section @ref{crs})</li>
<li>the total number of empty geometries in the set</li>
</ul>
<p>This means that all these properties are defined for the set, and not for geometries individually.</p>
</div>
<div id="st_cast-conversion-between-geometry-types" class="section level3">
<h3><span class="header-section-number">3.2.3</span> <code>st_cast</code>: Conversion between geometry types</h3>
<p>Also discuss <code>st_collection_extract</code>.</p>
</div>
</div>
<div id="geometries-on-the-spheroid" class="section level2">
<h2><span class="header-section-number">3.3</span> Geometries on the spheroid</h2>
<p>geometries on the sphere: dividing the sphere in two areas; ring direction, angles, distances, area.</p>
</div>
<div id="other-geometries" class="section level2">
<h2><span class="header-section-number">3.4</span> Other geometries</h2>
<p>coverage; raster cells; topological representation; three-dimensional volumes</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-sfa">
<p>Herring, John R. 2011. “OpenGIS Implementation Standard for Geographic Information-Simple Feature Access-Part 1: Common Architecture.” <em>Open Geospatial Consortium Inc</em>, 111. <a href="http://portal.opengeospatial.org/files/?artifact_id=25355" class="uri">http://portal.opengeospatial.org/files/?artifact_id=25355</a>.</p>
</div>
<div id="ref-sfa2">
<p>Herring, John R. 2010. “OpenGIS Implementation Standard for Geographic Information-Simple Feature Access-Part 2: SQL Option.” <em>Open Geospatial Consortium Inc</em>. <a href="http://portal.opengeospatial.org/files/?artifact_id=25354" class="uri">http://portal.opengeospatial.org/files/?artifact_id=25354</a>.</p>
</div>
<div id="ref-iso">
<p>ISO. 2004. <em>Geographic Information – Simple Feature Access – Part 1: Common Architecture</em>. <a href=" https://www.iso.org/standard/40114.html ">https://www.iso.org/standard/40114.html</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="spaces.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="vectorraster.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/edzer/sdsr/edit/master/03-Geometries.Rmd",
"text": "Edit"
},
"download": ["sdsr.pdf", "sdsr.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
