<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Spatial Data Science with R</title>
  <meta name="description" content="description_xx">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Spatial Data Science with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="description_xx" />
  <meta name="github-repo" content="edzer/sdsr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Spatial Data Science with R" />
  
  <meta name="twitter:description" content="description_xx" />
  

<meta name="author" content="Edzer Pebesma, Roger Bivand">


<meta name="date" content="2018-05-09">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="spaces-1-2-and-3-dimensional-spherical-time-bounded-spaces.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial Data Science with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Spatial Data</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-first-map"><i class="fa fa-check"></i><b>1.1</b> A first map</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#reading"><i class="fa fa-check"></i><b>1.2</b> Reading and writing</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="spaces-1-2-and-3-dimensional-spherical-time-bounded-spaces.html"><a href="spaces-1-2-and-3-dimensional-spherical-time-bounded-spaces.html"><i class="fa fa-check"></i><b>2</b> Spaces: 1, 2 and 3-dimensional, spherical, time, bounded spaces</a></li>
<li class="chapter" data-level="3" data-path="geometries.html"><a href="geometries.html"><i class="fa fa-check"></i><b>3</b> Geometries</a></li>
<li class="chapter" data-level="4" data-path="vectorraster.html"><a href="vectorraster.html"><i class="fa fa-check"></i><b>4</b> Vector/Raster</a></li>
<li class="chapter" data-level="5" data-path="geommanip.html"><a href="geommanip.html"><i class="fa fa-check"></i><b>5</b> Geometric Manipulations</a><ul>
<li class="chapter" data-level="5.1" data-path="geommanip.html"><a href="geommanip.html#unary-operations"><i class="fa fa-check"></i><b>5.1</b> Unary Operations</a></li>
<li class="chapter" data-level="5.2" data-path="geommanip.html"><a href="geommanip.html#binary-operations"><i class="fa fa-check"></i><b>5.2</b> Binary Operations</a></li>
<li class="chapter" data-level="5.3" data-path="geommanip.html"><a href="geommanip.html#n-ary-operations"><i class="fa fa-check"></i><b>5.3</b> N-ary Operations</a></li>
<li class="chapter" data-level="5.4" data-path="geommanip.html"><a href="geommanip.html#warnings-for-longitudelatitude-geometries"><i class="fa fa-check"></i><b>5.4</b> Warnings for longitude/latitude geometries</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="attributes.html"><a href="attributes.html"><i class="fa fa-check"></i><b>6</b> Attributes</a><ul>
<li class="chapter" data-level="6.1" data-path="attributes.html"><a href="attributes.html#agr"><i class="fa fa-check"></i><b>6.1</b> Attribute-geometry relationship</a></li>
<li class="chapter" data-level="6.2" data-path="attributes.html"><a href="attributes.html#area-weighted-interpolation"><i class="fa fa-check"></i><b>6.2</b> Area-weighted interpolation</a></li>
<li class="chapter" data-level="6.3" data-path="attributes.html"><a href="attributes.html#spatially-intensive-and-extensive-variables"><i class="fa fa-check"></i><b>6.3</b> Spatially intensive and extensive variables</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="reference-systems.html"><a href="reference-systems.html"><i class="fa fa-check"></i><b>7</b> Reference Systems</a><ul>
<li class="chapter" data-level="7.1" data-path="reference-systems.html"><a href="reference-systems.html#units"><i class="fa fa-check"></i><b>7.1</b> Units of measurement</a></li>
<li class="chapter" data-level="7.2" data-path="reference-systems.html"><a href="reference-systems.html#transform"><i class="fa fa-check"></i><b>7.2</b> Coordinate transformation and conversion</a></li>
</ul></li>
<li class="part"><span><b>II Maps</b></span></li>
<li class="chapter" data-level="8" data-path="plotting-spatial-data.html"><a href="plotting-spatial-data.html"><i class="fa fa-check"></i><b>8</b> Plotting spatial data</a></li>
<li class="chapter" data-level="9" data-path="plot.html"><a href="plot.html"><i class="fa fa-check"></i><b>9</b> Base Plot</a></li>
<li class="chapter" data-level="10" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>10</b> ggplot2</a></li>
<li class="chapter" data-level="11" data-path="interactive-maps.html"><a href="interactive-maps.html"><i class="fa fa-check"></i><b>11</b> Interactive Maps</a></li>
<li class="part"><span><b>III Spatial Analysis</b></span></li>
<li class="chapter" data-level="12" data-path="summarizing-geometries.html"><a href="summarizing-geometries.html"><i class="fa fa-check"></i><b>12</b> Summarizing Geometries</a></li>
<li class="chapter" data-level="13" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html"><i class="fa fa-check"></i><b>13</b> Point Pattern Analysis</a></li>
<li class="chapter" data-level="14" data-path="manipulating-attributes-summarise-aggregate-union-sample.html"><a href="manipulating-attributes-summarise-aggregate-union-sample.html"><i class="fa fa-check"></i><b>14</b> Manipulating attributes: summarise, aggregate, union, sample</a></li>
<li class="chapter" data-level="15" data-path="units-of-measure-revisited-attribute-units-intensive-and-extensive-variables.html"><a href="units-of-measure-revisited-attribute-units-intensive-and-extensive-variables.html"><i class="fa fa-check"></i><b>15</b> Units of measure revisited: attribute units, intensive and extensive variables</a></li>
<li class="chapter" data-level="16" data-path="up-and-downscaling.html"><a href="up-and-downscaling.html"><i class="fa fa-check"></i><b>16</b> Up- and Downscaling</a></li>
<li class="chapter" data-level="17" data-path="spatial-interpolation-and-geostatistics.html"><a href="spatial-interpolation-and-geostatistics.html"><i class="fa fa-check"></i><b>17</b> Spatial Interpolation and geostatistics</a></li>
<li class="chapter" data-level="18" data-path="area-data-and-spatial-correlation.html"><a href="area-data-and-spatial-correlation.html"><i class="fa fa-check"></i><b>18</b> Area Data and Spatial Correlation</a></li>
<li class="chapter" data-level="19" data-path="spatial-regression-and-autocorrelation.html"><a href="spatial-regression-and-autocorrelation.html"><i class="fa fa-check"></i><b>19</b> Spatial Regression and Autocorrelation</a></li>
<li class="chapter" data-level="20" data-path="raster-modelling.html"><a href="raster-modelling.html"><i class="fa fa-check"></i><b>20</b> Raster Modelling</a></li>
<li class="part"><span><b>IV Spatiotemporal Analysis</b></span></li>
<li class="chapter" data-level="21" data-path="array.html"><a href="array.html"><i class="fa fa-check"></i><b>21</b> Array data: raster and vector data cubes</a></li>
<li class="chapter" data-level="22" data-path="movement-data.html"><a href="movement-data.html"><i class="fa fa-check"></i><b>22</b> Movement data</a></li>
<li class="chapter" data-level="23" data-path="statistical-modelling-of-spatiotemporal-data.html"><a href="statistical-modelling-of-spatiotemporal-data.html"><i class="fa fa-check"></i><b>23</b> Statistical modelling of spatiotemporal data</a></li>
<li class="chapter" data-level="24" data-path="scalability.html"><a href="scalability.html"><i class="fa fa-check"></i><b>24</b> Scalability</a></li>
<li class="chapter" data-level="" data-path="r-data-structures.html"><a href="r-data-structures.html"><i class="fa fa-check"></i>R data structures</a><ul>
<li class="chapter" data-level="24.1" data-path="r-data-structures.html"><a href="r-data-structures.html#homogeneous-vectors"><i class="fa fa-check"></i><b>24.1</b> Homogeneous vectors</a></li>
<li class="chapter" data-level="24.2" data-path="r-data-structures.html"><a href="r-data-structures.html#heterogeneous-vectors-list"><i class="fa fa-check"></i><b>24.2</b> Heterogeneous vectors: list</a></li>
<li class="chapter" data-level="24.3" data-path="attributes.html"><a href="attributes.html#attributes"><i class="fa fa-check"></i><b>24.3</b> Attributes</a></li>
<li class="chapter" data-level="24.4" data-path="r-data-structures.html"><a href="r-data-structures.html#various-names-attributes"><i class="fa fa-check"></i><b>24.4</b> various names attributes</a></li>
<li class="chapter" data-level="24.5" data-path="r-data-structures.html"><a href="r-data-structures.html#using-structure"><i class="fa fa-check"></i><b>24.5</b> using structure</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial Data Science with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intro" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Getting Started</h1>
<p>This chapter gives a quick start to get you going with spatial data science with R. It is easier to read when understanding R at the level of, say, <a href="http://r4ds.had.co.nz/">R for Data Science</a> <span class="citation">(Wickham and Grolemund <a href="#ref-r4ds">2017</a>)</span>.</p>
<div id="a-first-map" class="section level2">
<h2><span class="header-section-number">1.1</span> A first map</h2>
<p>There is a lot to say about spatial data, but let us first create a map. We can create a simple map by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(sf)
<span class="kw">system.file</span>(<span class="st">&quot;gpkg/nc.gpkg&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">read_sf</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">st_transform</span>(<span class="dv">32119</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">select</span>(BIR74) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">plot</span>(<span class="dt">graticule =</span> <span class="ot">TRUE</span>, <span class="dt">axes =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:first-map"></span>
<img src="sdsr_files/figure-html/first-map-1.png" alt="a first map" width="672" />
<p class="caption">
Figure 1.1: a first map
</p>
</div>
<p>A lot went on, here. We will describe the steps in detail. First, we loaded two R packages:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(sf)</code></pre></div>
<p>where <code>tidyverse</code> is needed for the tidyverse functions and methods, and <code>sf</code> is needed for the spatial commands and spatial tidyverse methods. Package <code>sf</code> implements simple features, a standardised way to encode polygon data (points, lines, polygons). We will say more about simple features in chapter <a href="geometries.html#geometries">3</a>. Most commands in package <code>sf</code> start with <code>st_</code>, short for spatiotemporal, a convention it shares with e.g. PostGIS.</p>
<p>The <code>%&gt;%</code> (pipe) symbols should be read as <em>then</em>: we read</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">b</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">c</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">d</span>(<span class="dt">n =</span> <span class="dv">10</span>)</code></pre></div>
<p>as <em><code>a</code> then <code>b</code> then <code>c</code> then <code>d</code></em>, and that is just alternative syntax for</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">d</span>(<span class="kw">c</span>(<span class="kw">b</span>(a)), <span class="dt">n =</span> <span class="dv">10</span>)</code></pre></div>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tmp1 &lt;-<span class="st"> </span><span class="kw">b</span>(a)
tmp2 &lt;-<span class="st"> </span><span class="kw">c</span>(tmp1)
tmp3 &lt;-<span class="st"> </span><span class="kw">d</span>(tmp2, <span class="dt">n =</span> <span class="dv">10</span>)</code></pre></div>
<p>The pipe form is easier to read because we don’t have to go from right to left, and avoids the need to choose names for intermediate results.</p>
<p>For the illustration we picked a data file that comes with <code>sf</code>, the location of which depends on the operating system used:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;gpkg/nc.gpkg&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>))
<span class="co">#&gt; [1] &quot;/home/edzer/R/x86_64-pc-linux-gnu-library/3.4/sf/gpkg/nc.gpkg&quot;</span></code></pre></div>
<p>Never use <code>system.file</code> if you want to read your own data; in that case, <code>fname</code> should be the data source (typically file) name (section <a href="intro.html#reading">1.2</a>). (Parens around this expression are used to have the result not only stored, but also printed.)</p>
<p>Then, we read this file into R using <code>read_sf</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(nc &lt;-<span class="st"> </span><span class="kw">read_sf</span>(file))
<span class="co">#&gt; Simple feature collection with 100 features and 14 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -84.3 ymin: 33.9 xmax: -75.5 ymax: 36.6</span>
<span class="co">#&gt; epsg (SRID):    4267</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD27 +no_defs</span>
<span class="co">#&gt; # A tibble: 100 x 15</span>
<span class="co">#&gt;     AREA PERIMETER CNTY_ CNTY_ID NAME    FIPS  FIPSNO CRESS_ID BIR74 SID74</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 0.114       1.44  1825    1825 Ashe    37009  37009        5  1091  1.00</span>
<span class="co">#&gt; 2 0.0610      1.23  1827    1827 Allegh… 37005  37005        3   487  0   </span>
<span class="co">#&gt; 3 0.143       1.63  1828    1828 Surry   37171  37171       86  3188  5.00</span>
<span class="co">#&gt; 4 0.0700      2.97  1831    1831 Currit… 37053  37053       27   508  1.00</span>
<span class="co">#&gt; 5 0.153       2.21  1832    1832 Northa… 37131  37131       66  1421  9.00</span>
<span class="co">#&gt; 6 0.0970      1.67  1833    1833 Hertfo… 37091  37091       46  1452  7.00</span>
<span class="co">#&gt; # ... with 94 more rows, and 5 more variables: NWBIR74 &lt;dbl&gt;, BIR79 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   SID79 &lt;dbl&gt;, NWBIR79 &lt;dbl&gt;, geom &lt;MULTIPOLYGON [°]&gt;</span></code></pre></div>
<p>which creates a “spatial tibble”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(nc)
<span class="co">#&gt; [1] &quot;sf&quot;         &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></code></pre></div>
<p>This object is transformed into a new coordinate reference system (North Carolina State Plane, with EPSG code 32119):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(nc<span class="fl">.32119</span> &lt;-<span class="st"> </span><span class="kw">st_transform</span>(nc, <span class="dv">32119</span>))
<span class="co">#&gt; Simple feature collection with 100 features and 14 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 124000 ymin: 14700 xmax: 931000 ymax: 318000</span>
<span class="co">#&gt; epsg (SRID):    32119</span>
<span class="co">#&gt; proj4string:    +proj=lcc +lat_1=36.16666666666666 +lat_2=34.33333333333334 +lat_0=33.75 +lon_0=-79 +x_0=609601.22 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</span>
<span class="co">#&gt; # A tibble: 100 x 15</span>
<span class="co">#&gt;     AREA PERIMETER CNTY_ CNTY_ID NAME    FIPS  FIPSNO CRESS_ID BIR74 SID74</span>
<span class="co">#&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 0.114       1.44  1825    1825 Ashe    37009  37009        5  1091  1.00</span>
<span class="co">#&gt; 2 0.0610      1.23  1827    1827 Allegh… 37005  37005        3   487  0   </span>
<span class="co">#&gt; 3 0.143       1.63  1828    1828 Surry   37171  37171       86  3188  5.00</span>
<span class="co">#&gt; 4 0.0700      2.97  1831    1831 Currit… 37053  37053       27   508  1.00</span>
<span class="co">#&gt; 5 0.153       2.21  1832    1832 Northa… 37131  37131       66  1421  9.00</span>
<span class="co">#&gt; 6 0.0970      1.67  1833    1833 Hertfo… 37091  37091       46  1452  7.00</span>
<span class="co">#&gt; # ... with 94 more rows, and 5 more variables: NWBIR74 &lt;dbl&gt;, BIR79 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   SID79 &lt;dbl&gt;, NWBIR79 &lt;dbl&gt;, geom &lt;MULTIPOLYGON [m]&gt;</span></code></pre></div>
<p>and a single attribute column is selected</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(nc.<span class="fl">32119.</span>bir74 &lt;-<span class="st"> </span><span class="kw">select</span>(nc<span class="fl">.32119</span>, BIR74))
<span class="co">#&gt; Simple feature collection with 100 features and 1 field</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 124000 ymin: 14700 xmax: 931000 ymax: 318000</span>
<span class="co">#&gt; epsg (SRID):    32119</span>
<span class="co">#&gt; proj4string:    +proj=lcc +lat_1=36.16666666666666 +lat_2=34.33333333333334 +lat_0=33.75 +lon_0=-79 +x_0=609601.22 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</span>
<span class="co">#&gt; # A tibble: 100 x 2</span>
<span class="co">#&gt;   BIR74                                                               geom</span>
<span class="co">#&gt;   &lt;dbl&gt;                                                 &lt;MULTIPOLYGON [m]&gt;</span>
<span class="co">#&gt; 1  1091 (((387345 278387, 381334 282774, 379438 282943, 373250 290553, 36…</span>
<span class="co">#&gt; 2   487 (((408602 292425, 408565 293985, 406643 296873, 406420 3e+05, 402…</span>
<span class="co">#&gt; 3  3188 (((478717 277490, 476936 278867, 471503 279173, 470806 281394, 46…</span>
<span class="co">#&gt; 4   508 (((878194 289128, 877381 291117, 875994 290881, 874941 292805, 87…</span>
<span class="co">#&gt; 5  1421 (((769835 277796, 768364 274842, 762616 274401, 763168 269009, 76…</span>
<span class="co">#&gt; 6  1452 (((812328 277876, 791158 277012, 789882 277579, 777724 277107, 76…</span>
<span class="co">#&gt; # ... with 94 more rows</span></code></pre></div>
<p>Finally, the result is plotted, with the command:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(nc.<span class="fl">32119.</span>bir74, <span class="dt">graticule =</span> <span class="ot">TRUE</span>, <span class="dt">axes =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>as shown in figure <a href="intro.html#fig:first-map">1.1</a>.</p>
<p>Where do these commands come from? <code>library</code> and <code>system.file</code> are base R. We can ask for help about a particular command by entering e.g.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?library</code></pre></div>
<p>The command <code>read_sf</code> is an alternative to the <code>st_read</code>, which returns a spatial tibble instead of a spatial data frame, and will be discussed in section <a href="intro.html#reading">1.2</a>. The <code>st_transform</code> method is used here to convert from the geographic coordinates (degrees longitude and latitude) into “flat” coordinates, meaning <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> coordinates in a planar system. It will be discussed in section <a href="reference-systems.html#transform">7.2</a>. The <code>plot</code> method for <code>sf</code> objects chooses default colors and legends settings; we instructed it to add a graticule (the grey lines of equal longitude and latitude) and degree labels along the axes. It is described in chapter <a href="plot.html#plot">9</a>.</p>
<p>As witnessed by the plot, the plot command receives county polygons as well as <code>BIR74</code> values for each polygon. How is it possible that we <code>select</code> <em>only</em> the <code>BIR74</code> variable, but still can plot the polygons? This is because package <code>sf</code> provides a <code>select</code> method:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">methods</span>(select)
<span class="co">#&gt; [1] select.data.frame* select.default*    select.grouped_df*</span>
<span class="co">#&gt; [4] select.list        select.sf          select.tbl_cube*  </span>
<span class="co">#&gt; see &#39;?methods&#39; for accessing help and source code</span></code></pre></div>
<p>and this method (<code>select.sf</code>) makes the geometry (<code>geom</code>) sticky:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(BIR74) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">names</span>()
<span class="co">#&gt; [1] &quot;BIR74&quot; &quot;geom&quot;</span></code></pre></div>
<p>We get the “normal” <code>select</code> behaviour if we first coerce to a normal tibble:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>(<span class="dt">validate =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(BIR74) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">names</span>()
<span class="co">#&gt; [1] &quot;BIR74&quot;</span></code></pre></div>
<p>A ggplot is created when we use <code>geom_sf</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> nc<span class="fl">.32119</span>) <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(<span class="dt">fill =</span> BIR74) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colors =</span> <span class="kw">sf.colors</span>(<span class="dv">20</span>))</code></pre></div>
<p><img src="sdsr_files/figure-html/unnamed-chunk-17-1.png" width="672" style="display: block; margin: auto;" /> and a facet plot for a pair of columns in <code>nc.32119</code> is obtained by gathering the columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nc2 &lt;-<span class="st"> </span>nc<span class="fl">.32119</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(SID74, SID79) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(VAR, SID, <span class="op">-</span>geom)
<span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> nc2, <span class="kw">aes</span>(<span class="dt">fill =</span> SID)) <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>VAR, <span class="dt">ncol =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="dv">34</span><span class="op">:</span><span class="dv">36</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colors =</span> <span class="kw">sf.colors</span>(<span class="dv">20</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>))</code></pre></div>
<p><img src="sdsr_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;" /> An interactive, leaflet-type map is obtained by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(mapview))
<span class="co">#nc.32119 %&gt;% mapview(zcol = &quot;BIR74&quot;, legend = TRUE, col.regions = sf.colors)</span></code></pre></div>
</div>
<div id="reading" class="section level2">
<h2><span class="header-section-number">1.2</span> Reading and writing</h2>
<p>Typical R data science tasks start with reading data from an external source; this may be a file, or a set of files like a “shapefile”, or a database, or a web service. Package <code>sf</code> can read from a large number of different data sources; the following command shows how many</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span>(<span class="kw">st_drivers</span>(<span class="st">&quot;vector&quot;</span>)) <span class="co"># vector drivers</span>
<span class="co">#&gt; [1] 80</span>
<span class="kw">nrow</span>(<span class="kw">st_drivers</span>(<span class="st">&quot;raster&quot;</span>)) <span class="co"># raster drivers</span>
<span class="co">#&gt; [1] 136</span></code></pre></div>
<p>(the output you see may differ because of different operating system and configuration.)</p>
<div id="gdal" class="section level3">
<h3><span class="header-section-number">1.2.1</span> GDAL</h3>
<p><code>st_drivers</code> lists the drivers available to GDAL, the geospatial data abstraction library. This library can be seen as the swiss army knive of spatial data; besides for R it is used in Python, QGIS, PostGIS, <a href="https://trac.osgeo.org/gdal/wiki/SoftwareUsingGdal">and more than 100 other software projects</a>. The dependency of <code>sf</code> on other R libraries and system libraries is shown in figure <a href="intro.html#fig:gdal-fig">1.2</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:gdal-fig"></span>
<img src="images/sf_deps.png" alt="sf and its dependencies"  />
<p class="caption">
Figure 1.2: sf and its dependencies
</p>
</div>
<p>Note that the C/C++ libraries used (GDAL, GEOS, Proj, liblwgeom, udunits2) are all developed, maintained and used by (data) science communities that are much larger than the R community. By using these libraries, we share how we understand what we are doing with all the other communities that use these libraries. This is not only important for resolving problems, but also for establishing which findings are facts.</p>
<p>GDAL is a “library of libraries” – in order to read all these data sources it needs a large number of other libraries. It typically links to over 100 other libraries. Binary packages distributed by CRAN contain only statically linked code: CRAN does not want to make any assumptions about presence of third-party libraries on the host system. As a consequence, when the binary <code>sf</code> package is installed from CRAN, it includes a copy of all the required external libraries as well as their dependencies, which may amount to 50 or 100 Mb.</p>
</div>
<div id="st_read-or-read_sf" class="section level3">
<h3><span class="header-section-number">1.2.2</span> <code>st_read</code> or <code>read_sf</code>?</h3>
<p>The function to read vector data is <code>st_read</code>. Function <code>read_sf</code> is largely the same as `st_read, but chooses a few tidyverse-style defaults:</p>
<ul>
<li>it is silent by default, where <code>st_read</code> gives a short report</li>
<li>it returns a spatial tibble instead of a spatial data frame</li>
<li>it sets as default <code>stringsAsFactors = FALSE</code>, where <code>st_read</code> listens to the global option <code>default.stringsAsFactors()</code> (which is <code>TRUE</code> by default)</li>
</ul>
<p>In the same fashion, compared to <code>st_write</code> <code>write_sf</code>,</p>
<ul>
<li>is also silent</li>
<li>overwrites layers (i.e., sets <code>delete_layer = TRUE</code>) by default, which <code>st_write</code> does not do.</li>
</ul>
<p>(TBD: reading and writing raster data)</p>
</div>
<div id="getting-help" class="section level3">
<h3><span class="header-section-number">1.2.3</span> Getting help</h3>
</div>
<div id="reading-from-files-and-shapefiles" class="section level3">
<h3><span class="header-section-number">1.2.4</span> Reading from files, and shapefiles</h3>
<p>We saw above that a spatial dataset can be read from a single file by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nc &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;gpkg/nc.gpkg&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">read_sf</span>()</code></pre></div>
<p>In some cases, spatial datasets are contained in <em>multiple</em> files, e.g. in the case of shapefiles. A “shapefile” should be really understood as a set of files with a common prefix, or even a directory with several of such sets.</p>
<p>Package <code>sf</code> comes with a couple of shapefiles packaged, a directory listing of the <code>shape</code> directory in the packge is obtained by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">list.files</span>(<span class="kw">system.file</span>(<span class="st">&quot;shape/&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;sf&quot;</span>))
<span class="co">#&gt;  [1] &quot;nc.dbf&quot;                  &quot;nc.prj&quot;                 </span>
<span class="co">#&gt;  [3] &quot;nc.shp&quot;                  &quot;nc.shx&quot;                 </span>
<span class="co">#&gt;  [5] &quot;storms_xyz_feature.dbf&quot;  &quot;storms_xyz_feature.shp&quot; </span>
<span class="co">#&gt;  [7] &quot;storms_xyz_feature.shx&quot;  &quot;storms_xyz.dbf&quot;         </span>
<span class="co">#&gt;  [9] &quot;storms_xyz.shp&quot;          &quot;storms_xyz.shx&quot;         </span>
<span class="co">#&gt; [11] &quot;storms_xyzm_feature.dbf&quot; &quot;storms_xyzm_feature.shp&quot;</span>
<span class="co">#&gt; [13] &quot;storms_xyzm_feature.shx&quot; &quot;storms_xyzm.dbf&quot;        </span>
<span class="co">#&gt; [15] &quot;storms_xyzm.shp&quot;         &quot;storms_xyzm.shx&quot;</span></code></pre></div>
<p>We can read a single shapefile by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nc &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;shape/nc.shp&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">read_sf</span>()</code></pre></div>
<p>and it is important to know that in that case all four files starting with <code>nc</code> are read from this directory.</p>
<p>We can also read the directory with shapfiles by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">something &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;shape&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">read_sf</span>()
<span class="co">#&gt; Warning in evalq((function (..., call. = TRUE, immediate. = FALSE,</span>
<span class="co">#&gt; noBreaks. = FALSE, : automatically selected the first layer in a data</span>
<span class="co">#&gt; source containing more than one.</span></code></pre></div>
<p>but we see some warnings now, indicating that we are reading only the first layer from a multi-layer dataset (and not <code>nc.shp</code>!). Indeed, this directory contains multiple layers, which can be queried by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.file</span>(<span class="st">&quot;shape&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_layers</span>()
<span class="co">#&gt; Driver: ESRI Shapefile </span>
<span class="co">#&gt; Available layers:</span>
<span class="co">#&gt;            layer_name        geometry_type features fields</span>
<span class="co">#&gt; 1 storms_xyzm_feature Measured Line String       71      1</span>
<span class="co">#&gt; 2  storms_xyz_feature       3D Line String       71      1</span>
<span class="co">#&gt; 3         storms_xyzm Measured Line String       71      0</span>
<span class="co">#&gt; 4          storms_xyz       3D Line String       71      0</span>
<span class="co">#&gt; 5                  nc              Polygon      100     14</span></code></pre></div>
<p>From this list, we could pick one, and use it as the <code>layer</code> argument, as in</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;shape&quot;</span>, <span class="dt">package=</span><span class="st">&quot;sf&quot;</span>)
layer &lt;-<span class="st"> &quot;nc&quot;</span>
nc &lt;-<span class="st"> </span><span class="kw">read_sf</span>(dataset, layer)</code></pre></div>
<p>which is essentially a convoluted way of what we did before to read <code>nc.shp</code>.</p>
<p>Considering shapefiles in directories as layers in a dataset is not something that <code>sf</code> came up with, but is the way GDAL handles this. Although it is a good idea in general to <a href="http://switchfromshapefile.org/">give up using shapefiles</a>, we cannot always control the format of the spatial data we get to start with.</p>
</div>
<div id="reading-from-a-text-string" class="section level3">
<h3><span class="header-section-number">1.2.5</span> Reading from a text string</h3>
<p>In the special case of a GeoJSON <span class="citation">(Butler et al. <a href="#ref-geojson">2016</a>)</span> dataset, when the dataset is contained in a length-one character vector, it can be directly passed to <code>read_sf</code> and read from memory:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">str &lt;-<span class="st"> &#39;{</span>
<span class="st">  &quot;type&quot;: &quot;FeatureCollection&quot;,</span>
<span class="st">  &quot;features&quot;: [</span>
<span class="st">    { &quot;type&quot;: &quot;Feature&quot;,</span>
<span class="st">      &quot;geometry&quot;: {</span>
<span class="st">        &quot;type&quot;: &quot;Point&quot;,</span>
<span class="st">        &quot;coordinates&quot;: [102.0, 0.5]</span>
<span class="st">      },</span>
<span class="st">      &quot;properties&quot;: {</span>
<span class="st">        &quot;prop0&quot;: &quot;value0&quot;</span>
<span class="st">      }</span>
<span class="st">    },</span>
<span class="st">    { &quot;type&quot;: &quot;Feature&quot;,</span>
<span class="st">      &quot;geometry&quot;: {</span>
<span class="st">        &quot;type&quot;: &quot;LineString&quot;,</span>
<span class="st">        &quot;coordinates&quot;: [</span>
<span class="st">          [102.0, 0.0], [103.0, 1.0], [104.0, 0.0], [105.0, 1.0]</span>
<span class="st">        ]</span>
<span class="st">      },</span>
<span class="st">      &quot;properties&quot;: {</span>
<span class="st">        &quot;prop0&quot;: &quot;value0&quot;,</span>
<span class="st">        &quot;prop1&quot;: 0.0</span>
<span class="st">      }</span>
<span class="st">    },</span>
<span class="st">    { &quot;type&quot;: &quot;Feature&quot;,</span>
<span class="st">      &quot;geometry&quot;: {</span>
<span class="st">        &quot;type&quot;: &quot;Polygon&quot;,</span>
<span class="st">        &quot;coordinates&quot;: [</span>
<span class="st">          [</span>
<span class="st">            [100.0, 0.0], [101.0, 0.0], [101.0, 1.0],</span>
<span class="st">            [100.0, 1.0], [100.0, 0.0]</span>
<span class="st">          ]</span>
<span class="st">        ]</span>
<span class="st">      },</span>
<span class="st">      &quot;properties&quot;: {</span>
<span class="st">        &quot;prop0&quot;: &quot;value0&quot;,</span>
<span class="st">        &quot;prop1&quot;: { &quot;this&quot;: &quot;that&quot; }</span>
<span class="st">      }</span>
<span class="st">    }</span>
<span class="st">  ]</span>
<span class="st">}&#39;</span>
(sf_obj &lt;-<span class="st"> </span><span class="kw">read_sf</span>(str))
<span class="co">#&gt; Simple feature collection with 3 features and 2 fields</span>
<span class="co">#&gt; geometry type:  GEOMETRY</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 100 ymin: 0 xmax: 105 ymax: 1</span>
<span class="co">#&gt; epsg (SRID):    4326</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span>
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   prop0  prop1                                                    geometry</span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;                                              &lt;GEOMETRY [°]&gt;</span>
<span class="co">#&gt; 1 value0 &lt;NA&gt;                                              POINT (102 0.5)</span>
<span class="co">#&gt; 2 value0 0.0                       LINESTRING (102 0, 103 1, 104 0, 105 1)</span>
<span class="co">#&gt; 3 value0 &quot;{ \&quot;this\&quot;: \&quot;that\&quot; }&quot; POLYGON ((100 0, 101 0, 101 1, 100 1, 1…</span></code></pre></div>
</div>
<div id="database" class="section level3">
<h3><span class="header-section-number">1.2.6</span> Database</h3>
<p>reading and writing databases</p>
</div>
</div>
<div id="exercises" class="section level2">
<h2><span class="header-section-number">1.3</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li>Read the shapefile <code>storms_xyz_feature</code> from the <code>shape</code> directory in the <code>sf</code> package</li>
<li>Copy this file to another directory on your computer, and read it from there (note: a shapefile consists of more than one file!)</li>
<li>How many features does this dataset contain?</li>
<li>Plot the dataset, with <code>axes = TRUE</code> (hint: before plotting, pipe through <code>st_zm</code> to drop Z and M coordinates; more about this in chapter <a href="geometries.html#geometries">3</a>).</li>
<li>Before plotting, pipe the dataset through <code>st_set_crs(4326)</code>. What is different in the plot obtained?</li>
</ol>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-r4ds">
<p>Wickham, Hadley, and Garret Grolemund. 2017. <em>R for Data Science</em>. O’Reilly. <a href="http://r4ds.had.co.nz/" class="uri">http://r4ds.had.co.nz/</a>.</p>
</div>
<div id="ref-geojson">
<p>Butler, H., M. Daly, Cadcorp, A. Doyle, S. Gillies, Mapbox, S. Hagen, T. Schaub, and Planet Labs. 2016. “The Geojson Format.” Internet Engineering Task Force (IETF). <a href="https://tools.ietf.org/html/rfc7946" class="uri">https://tools.ietf.org/html/rfc7946</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spaces-1-2-and-3-dimensional-spherical-time-bounded-spaces.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/edzer/sdsr/edit/master/01-hello.Rmd",
"text": "Edit"
},
"download": ["sdsr.pdf", "sdsr.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
